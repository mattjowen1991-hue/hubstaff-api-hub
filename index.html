<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hubstaff API Support Assistant</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #39b54a;
            --primary-dark: #2d9340;
            --bg-dark: #0a0f1a;
            --bg-card: #111827;
            --bg-card-hover: #1a2332;
            --text-primary: #f0f4f8;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #1e293b;
            --accent-blue: #3b82f6;
            --accent-purple: #8b5cf6;
            --accent-orange: #f97316;
            --accent-red: #ef4444;
            --accent-yellow: #eab308;
            --get: #22c55e;
            --post: #3b82f6;
            --put: #f97316;
            --delete: #ef4444;
            --patch: #a855f7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            background-image: 
                radial-gradient(ellipse at top, rgba(57, 181, 74, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at bottom right, rgba(59, 130, 246, 0.05) 0%, transparent 50%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem 0;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--text-secondary);
            margin-top: 0.5rem;
            font-size: 1rem;
        }

        .search-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .search-container {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .search-input-wrapper {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1.25rem;
            padding-left: 3rem;
            font-size: 1rem;
            font-family: inherit;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(57, 181, 74, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .search-btn {
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            font-family: inherit;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(57, 181, 74, 0.3);
        }

        .quick-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .quick-btn {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            font-family: inherit;
            background: var(--bg-dark);
            color: var(--text-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-btn:hover {
            background: var(--bg-card-hover);
            color: var(--text-primary);
            border-color: var(--primary);
        }

        .results-section {
            margin-bottom: 2rem;
        }

        .answer-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
        }

        .answer-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .answer-icon {
            width: 40px;
            height: 40px;
            background: rgba(57, 181, 74, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        .answer-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .answer-content {
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .answer-content p {
            margin-bottom: 1rem;
        }

        .answer-content strong {
            color: var(--text-primary);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-supported {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .status-indirect {
            background: rgba(249, 115, 22, 0.15);
            color: #f97316;
        }

        .status-unavailable {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .endpoints-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .endpoint-card {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.2s;
        }

        .endpoint-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .endpoint-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .method-badge {
            padding: 0.25rem 0.6rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            text-transform: uppercase;
        }

        .method-get { background: rgba(34, 197, 94, 0.15); color: var(--get); }
        .method-post { background: rgba(59, 130, 246, 0.15); color: var(--post); }
        .method-put { background: rgba(249, 115, 22, 0.15); color: var(--put); }
        .method-delete { background: rgba(239, 68, 68, 0.15); color: var(--delete); }
        .method-patch { background: rgba(168, 85, 247, 0.15); color: var(--patch); }

        .endpoint-path {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-primary);
            word-break: break-all;
        }

        .endpoint-description {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        .category-section {
            margin-bottom: 2rem;
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            cursor: pointer;
            padding: 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: all 0.2s;
        }

        .category-header:hover {
            background: var(--bg-card-hover);
        }

        .category-icon {
            width: 36px;
            height: 36px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-blue);
        }

        .category-title {
            font-size: 1.1rem;
            font-weight: 600;
            flex: 1;
        }

        .category-count {
            background: var(--bg-dark);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .category-content {
            display: none;
            padding-left: 1rem;
        }

        .category-content.open {
            display: block;
        }

        .copy-btn {
            padding: 0.75rem 1.5rem;
            font-size: 0.9rem;
            font-family: inherit;
            background: var(--bg-dark);
            color: var(--text-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .copy-btn:hover {
            background: var(--bg-card-hover);
            color: var(--primary);
            border-color: var(--primary);
        }

        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            padding: 1rem 1.25rem;
            margin: 1rem 0;
            display: flex;
            gap: 0.75rem;
        }

        .info-box.warning {
            background: rgba(249, 115, 22, 0.1);
            border-color: rgba(249, 115, 22, 0.2);
        }

        .info-box.success {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.2);
        }

        .info-icon {
            color: var(--accent-blue);
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .info-box.warning .info-icon {
            color: var(--accent-orange);
        }

        .info-box.success .info-icon {
            color: var(--primary);
        }

        .info-content {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .knowledge-base {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            margin-top: 2rem;
        }

        .kb-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .kb-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
        }

        .kb-content {
            padding: 1.5rem;
            display: none;
        }

        .kb-content.open {
            display: block;
        }

        .kb-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .kb-item {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
        }

        .kb-item-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .kb-item-desc {
            font-size: 0.85rem;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .related-topics {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .related-title {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }

        .related-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .related-tag {
            padding: 0.4rem 0.8rem;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .related-tag:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            .search-container {
                flex-direction: column;
            }

            .search-input-wrapper {
                min-width: 100%;
            }

            .endpoints-grid {
                grid-template-columns: 1fr;
            }

            .kb-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">üîå</div>
                <h1>Hubstaff API Assistant</h1>
            </div>
            <p class="subtitle">Get instant answers about Hubstaff API capabilities for integration questions</p>
        </header>

        <section class="search-section">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" id="searchInput" 
                           placeholder="Ask about Hubstaff API capabilities..." 
                           autocomplete="off">
                </div>
                <button class="search-btn" onclick="handleSearch()">
                    <span>Search</span>
                    <span>‚Üí</span>
                </button>
                <button class="search-btn" onclick="clearSearch()" style="background: var(--bg-dark); border: 1px solid var(--border);">
                    <span>Clear</span>
                    <span>‚úï</span>
                </button>
            </div>
            <div class="quick-actions">
                <button class="quick-btn" onclick="quickSearch('time tracking sync')">‚è±Ô∏è Time Tracking</button>
                <button class="quick-btn" onclick="quickSearch('attendance check-in')">üìã Attendance</button>
                <button class="quick-btn" onclick="quickSearch('projects tasks')">üìÅ Projects & Tasks</button>
                <button class="quick-btn" onclick="quickSearch('screenshots monitoring')">üì∏ Screenshots</button>
                <button class="quick-btn" onclick="quickSearch('authentication oauth')">üîê Authentication</button>
                <button class="quick-btn" onclick="quickSearch('webhooks')">üîî Webhooks</button>
                <button class="quick-btn" onclick="quickSearch('rate limits')">‚ö° Rate Limits</button>
                <button class="quick-btn" onclick="quickSearch('users members')">üë• Users & Teams</button>
                <button class="quick-btn" onclick="quickSearch('developer resources')">üõ†Ô∏è Dev Resources</button>
            </div>
        </section>

        <section class="results-section" id="resultsSection">
            <div class="empty-state" id="emptyState">
                <div class="empty-icon">üí°</div>
                <h3>Ask a question about Hubstaff API</h3>
                <p>For example: "Can I sync timesheets with an ERP?" or "What authentication methods are supported?"</p>
            </div>
        </section>

        <div class="knowledge-base">
            <div class="kb-header" onclick="toggleKnowledgeBase()">
                <div class="kb-title">
                    <span>üìö</span>
                    <span>API Knowledge Base Reference</span>
                </div>
                <span id="kbToggle">‚ñº</span>
            </div>
            <div class="kb-content" id="kbContent">
                <div class="kb-grid" id="kbGrid"></div>
            </div>
        </div>
    </div>

    <script>
        // Comprehensive Hubstaff API Knowledge Base from official documentation
        const apiKnowledge = {
            authentication: {
                title: "Authentication",
                icon: "üîê",
                description: "OAuth 2.0, Personal Access Tokens, and App Tokens supported",
                details: [
                    "OAuth 2.0 authorization flow for third-party apps",
                    "Personal Access Tokens (PAT) for direct API access",
                    "App Tokens for server-to-server integrations",
                    "Bearer token authentication in headers",
                    "Token refresh mechanism available"
                ],
                planAccess: "Team and Enterprise plans include API access",
                status: "supported"
            },
            activities: {
                title: "Activities (Time Tracking)",
                icon: "‚è±Ô∏è",
                description: "Track work activities, time logs, and productivity metrics",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/activities", desc: "List organization activities" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/activities/updates", desc: "Get activity updates" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/activities/daily", desc: "Get daily activity summaries" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/activities/daily/updates", desc: "Get daily updates" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/last_activities", desc: "Get last activities" },
                    { method: "GET", path: "/v2/projects/{project_id}/activities", desc: "List project activities" },
                    { method: "GET", path: "/v2/projects/{project_id}/activities/updates", desc: "Get project activity updates" },
                    { method: "GET", path: "/v2/projects/{project_id}/activities/daily", desc: "Get project daily activities" },
                    { method: "GET", path: "/v2/projects/{project_id}/last_activities", desc: "Get project last activities" },
                    { method: "GET", path: "/v2/projects/{project_id}/activities/daily/updates", desc: "List project daily activities updates" }
                ],
                status: "supported"
            },
            timesheets: {
                title: "Timesheets",
                icon: "üìä",
                description: "Access timesheet data for payroll and reporting",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/timesheets", desc: "List organization timesheets" }
                ],
                details: [
                    "Contains aggregated time data per user/project",
                    "Includes tracked time, idle time, and manual time",
                    "Supports date range filtering",
                    "Can group by user, project, or date"
                ],
                status: "supported"
            },
            timeEntries: {
                title: "Time Entries",
                icon: "üïê",
                description: "Individual time entry records with start/stop times",
                endpoints: [
                    { method: "GET", path: "/v2/users/{user_id}/time_entries", desc: "List user time entries" },
                    { method: "POST", path: "/v2/users/{user_id}/time_entries", desc: "Create time entry" }
                ],
                details: [
                    "Individual time tracking records",
                    "Includes start time, stop time, and duration",
                    "Links to projects and tasks"
                ],
                status: "supported"
            },
            attendance: {
                title: "Attendance",
                icon: "üìã",
                description: "Attendance schedules, shifts, and check-in/check-out",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/attendance_schedules", desc: "List attendance schedules" },
                    { method: "POST", path: "/v2/organizations/{organization_id}/attendance_schedules", desc: "Create attendance schedule" },
                    { method: "PUT", path: "/v2/attendance_schedules/{attendance_schedule_id}", desc: "Update attendance schedule" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/attendance_shifts", desc: "List attendance shifts" }
                ],
                details: [
                    "Attendance is derived from activity tracking (first/last activity times)",
                    "Attendance schedules define expected work hours",
                    "Attendance shifts track actual working periods",
                    "For explicit check-in/check-out: Use Job Sites with geofencing (Locations feature)"
                ],
                status: "supported",
                notes: "Attendance data is derived from time tracking. For explicit check-in/check-out, Job Site Visits API provides geolocation-based attendance."
            },
            projects: {
                title: "Projects",
                icon: "üìÅ",
                description: "Full CRUD operations for project management",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/projects", desc: "List organization projects" },
                    { method: "POST", path: "/v2/organizations/{organization_id}/projects", desc: "Create new project" },
                    { method: "GET", path: "/v2/projects/{project_id}", desc: "Get project details" },
                    { method: "PUT", path: "/v2/projects/{project_id}", desc: "Update project" },
                    { method: "PUT", path: "/v2/projects/{project_id}/update_metadata", desc: "Update project metadata" }
                ],
                status: "supported"
            },
            tasks: {
                title: "Tasks",
                icon: "‚úÖ",
                description: "Full CRUD operations for task management",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/tasks", desc: "List organization tasks" },
                    { method: "GET", path: "/v2/projects/{project_id}/tasks", desc: "List project tasks" },
                    { method: "POST", path: "/v2/projects/{project_id}/tasks", desc: "Create task in project" },
                    { method: "GET", path: "/v2/tasks/{task_id}", desc: "Get task details" },
                    { method: "PUT", path: "/v2/tasks/{task_id}", desc: "Update task" },
                    { method: "DELETE", path: "/v2/tasks/{task_id}", desc: "Delete task" },
                    { method: "PUT", path: "/v2/tasks/{task_id}/update_metadata", desc: "Update task metadata" },
                    { method: "GET", path: "/v2/integrations/{integration_id}/tasks", desc: "List integration tasks" }
                ],
                status: "supported"
            },
            users: {
                title: "Users",
                icon: "üë§",
                description: "User profile and information access",
                endpoints: [
                    { method: "GET", path: "/v2/users/me", desc: "Get current user profile" },
                    { method: "GET", path: "/v2/users/{user_id}", desc: "Get user by ID" }
                ],
                status: "supported"
            },
            members: {
                title: "Members (Organization/Team)",
                icon: "üë•",
                description: "Manage organization and team membership",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/members", desc: "List organization members" },
                    { method: "POST", path: "/v2/organizations/{organization_id}/members", desc: "Add organization member" },
                    { method: "PUT", path: "/v2/organizations/{organization_id}/update_members", desc: "Update organization members" },
                    { method: "GET", path: "/v2/projects/{project_id}/members", desc: "List project members" },
                    { method: "PUT", path: "/v2/projects/{project_id}/update_members", desc: "Update project members" },
                    { method: "GET", path: "/v2/teams/{team_id}/members", desc: "List team members" },
                    { method: "PUT", path: "/v2/teams/{team_id}/update_members", desc: "Update team members" }
                ],
                status: "supported"
            },
            teams: {
                title: "Teams",
                icon: "üè¢",
                description: "Team management and organization",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/teams", desc: "List organization teams" },
                    { method: "POST", path: "/v2/organizations/{organization_id}/teams", desc: "Create team" },
                    { method: "GET", path: "/v2/teams/{team_id}", desc: "Get team details" },
                    { method: "PUT", path: "/v2/teams/{team_id}", desc: "Update team" },
                    { method: "DELETE", path: "/v2/teams/{team_id}", desc: "Delete team" },
                    { method: "GET", path: "/v2/teams/{team_id}/projects", desc: "List team projects" },
                    { method: "PUT", path: "/v2/teams/{team_id}/update_projects", desc: "Update team projects" },
                    { method: "PUT", path: "/v2/teams/{team_id}/update_metadata", desc: "Update team metadata" }
                ],
                status: "supported"
            },
            organizations: {
                title: "Organizations",
                icon: "üèõÔ∏è",
                description: "Organization-level settings and data",
                endpoints: [
                    { method: "GET", path: "/v2/organizations", desc: "List organizations" },
                    { method: "POST", path: "/v2/organizations", desc: "Create organization" },
                    { method: "GET", path: "/v2/organizations/{organization_id}", desc: "Get organization details" },
                    { method: "PUT", path: "/v2/organizations/{organization_id}/update_metadata", desc: "Update organization metadata" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/work_break_projects", desc: "Get work break projects" }
                ],
                status: "supported"
            },
            screenshots: {
                title: "Screenshots",
                icon: "üì∏",
                description: "Access captured screenshots for monitoring",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/screenshots", desc: "List organization screenshots" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/screenshots/{screenshot_id}", desc: "Get screenshot details" },
                    { method: "GET", path: "/v2/projects/{project_id}/screenshots", desc: "List project screenshots" },
                    { method: "GET", path: "/v2/projects/{project_id}/screenshots/{screenshot_id}", desc: "Get project screenshot" }
                ],
                status: "supported"
            },
            jobSites: {
                title: "Job Sites (Locations/Geofencing)",
                icon: "üìç",
                description: "Geolocation-based job sites for field tracking",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/job_sites", desc: "List job sites" },
                    { method: "POST", path: "/v2/organizations/{organization_id}/job_sites", desc: "Create job site" },
                    { method: "GET", path: "/v2/job_sites/{job_site_id}", desc: "Get job site details" },
                    { method: "PUT", path: "/v2/job_sites/{job_site_id}", desc: "Update job site" },
                    { method: "PUT", path: "/v2/job_sites/{job_site_id}/update_rules", desc: "Update geofence rules" },
                    { method: "PUT", path: "/v2/job_sites/{job_site_id}/add_rules", desc: "Add geofence rules" },
                    { method: "PUT", path: "/v2/job_sites/{job_site_id}/remove_rules", desc: "Remove geofence rules" }
                ],
                status: "supported"
            },
            jobSiteVisits: {
                title: "Job Site Visits (Check-in/Check-out)",
                icon: "üö∂",
                description: "Track arrivals and departures at job sites",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/job_site_visits", desc: "List job site visits" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/passive_job_site_visits", desc: "List passive visits" }
                ],
                details: [
                    "Provides explicit check-in/check-out data via geofencing",
                    "Records arrival and departure times at defined locations",
                    "Ideal for field service attendance tracking"
                ],
                status: "supported"
            },
            locations: {
                title: "Locations",
                icon: "üó∫Ô∏è",
                description: "GPS location tracking data",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/locations", desc: "List organization locations" },
                    { method: "GET", path: "/v2/projects/{project_id}/locations", desc: "List project locations" }
                ],
                status: "supported"
            },
            webhooks: {
                title: "Webhooks",
                icon: "üîî",
                description: "Real-time event notifications",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/webhooks", desc: "List organization webhooks" },
                    { method: "POST", path: "/v2/organizations/{organization_id}/webhooks", desc: "Create webhook" },
                    { method: "GET", path: "/v2/projects/{project_id}/webhooks", desc: "List project webhooks" },
                    { method: "GET", path: "/v2/users/me/webhooks", desc: "List user webhooks" },
                    { method: "GET", path: "/v2/webhooks/{webhook_id}", desc: "Get webhook details" },
                    { method: "DELETE", path: "/v2/webhooks/{webhook_id}", desc: "Delete webhook" },
                    { method: "POST", path: "/v2/webhooks/{webhook_id}/activate", desc: "Activate webhook" },
                    { method: "POST", path: "/v2/users/me/webhooks", desc: "Create me webhook" },
                    { method: "POST", path: "/v2/projects/{project_id}/webhooks", desc: "Create project webhook" }
                ],
                details: [
                    "Supported events: time_entry, activity, screenshot, project, task, user updates",
                    "Requires endpoint verification after creation",
                    "POST request sent to your URL with x-hs-verification header"
                ],
                status: "supported"
            },
            clients: {
                title: "Clients",
                icon: "ü§ù",
                description: "Client/customer management",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/clients", desc: "List clients" },
                    { method: "POST", path: "/v2/organizations/{organization_id}/clients", desc: "Create client" },
                    { method: "GET", path: "/v2/clients/{client_id}", desc: "Get client details" },
                    { method: "PUT", path: "/v2/clients/{client_id}", desc: "Update client" },
                    { method: "PUT", path: "/v2/clients/{client_id}/update_metadata", desc: "Update client metadata" }
                ],
                status: "supported"
            },
            invites: {
                title: "Invites",
                icon: "‚úâÔ∏è",
                description: "Manage team invitations",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/invites", desc: "List invites" },
                    { method: "POST", path: "/v2/organizations/{organization_id}/invites", desc: "Create invite" },
                    { method: "POST", path: "/v2/organizations/{organization_id}/invites/bulk", desc: "Bulk create invites" },
                    { method: "GET", path: "/v2/invites/{invite_id}", desc: "Get invite details" },
                    { method: "PUT", path: "/v2/invites/{invite_id}", desc: "Update invite" },
                    { method: "DELETE", path: "/v2/invites/{invite_id}", desc: "Delete invite" }
                ],
                status: "supported"
            },
            notes: {
                title: "Notes",
                icon: "üìù",
                description: "User and project notes",
                endpoints: [
                    { method: "GET", path: "/v2/notes/{note_id}", desc: "Get note" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/notes", desc: "List organization notes" },
                    { method: "GET", path: "/v2/projects/{project_id}/notes", desc: "List project notes" }
                ],
                status: "supported"
            },
            rates: {
                title: "Rates (Billing)",
                icon: "üí∞",
                description: "Billing rates for users and projects",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/rates", desc: "List rates" }
                ],
                status: "supported"
            },
            invoices: {
                title: "Invoices",
                icon: "üßæ",
                description: "Client and team invoicing",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/client_invoices", desc: "List client invoices" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/team_invoices", desc: "List team invoices" }
                ],
                status: "supported"
            },
            payments: {
                title: "Payments",
                icon: "üí≥",
                description: "Team payment records",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/team_payments", desc: "List team payments" },
                    { method: "GET", path: "/v2/team_payments/{team_payment_id}", desc: "Get payment details" }
                ],
                status: "supported"
            },
            toolUsages: {
                title: "Tool/App Usage",
                icon: "üñ•Ô∏è",
                description: "Application and website usage tracking",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/tool_usages", desc: "List tool usages" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/tool_usages/daily", desc: "Daily tool usage" },
                    { method: "GET", path: "/v2/projects/{project_id}/tool_usages", desc: "Project tool usages" },
                    { method: "GET", path: "/v2/projects/{project_id}/tool_usages/daily", desc: "Project daily tool usage" }
                ],
                status: "supported"
            },
            timeOff: {
                title: "Time Off",
                icon: "üèñÔ∏è",
                description: "Leave/PTO management",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/time_off_policies", desc: "List time off policies" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/time_off_requests", desc: "List time off requests" }
                ],
                status: "supported"
            },
            holidays: {
                title: "Holidays",
                icon: "üéÑ",
                description: "Organization holiday schedules",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/holidays", desc: "List holidays" }
                ],
                status: "supported"
            },
            budgets: {
                title: "Budgets",
                icon: "üìà",
                description: "Project and client budget tracking",
                endpoints: [
                    { method: "GET", path: "/v2/budget_histories/{budget_history_id}", desc: "Get budget history" },
                    { method: "GET", path: "/v2/clients/{client_id}/budget_histories", desc: "Client budget histories" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/budget_histories", desc: "Organization budget histories" },
                    { method: "GET", path: "/v2/projects/{project_id}/budget_histories", desc: "Project budget histories" }
                ],
                status: "supported"
            },
            limits: {
                title: "Limits",
                icon: "‚è∞",
                description: "Work hour limits and tracking",
                endpoints: [
                    { method: "GET", path: "/v2/limit_histories/{limit_history_id}", desc: "Get limit history" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/limit_histories", desc: "List limit histories" }
                ],
                status: "supported"
            },
            integrations: {
                title: "Integrations",
                icon: "üîó",
                description: "Third-party integrations management",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/integrations", desc: "List integrations" },
                    { method: "GET", path: "/v2/integrations/{integration_id}/project_links", desc: "Integration project links" },
                    { method: "GET", path: "/v2/integrations/{integration_id}/user_links", desc: "Integration user links" },
                    { method: "GET", path: "/v2/projects/{project_id}/integration_links", desc: "Project integration links" }
                ],
                status: "supported"
            },
            timeEditLogs: {
                title: "Time Edit Logs",
                icon: "üìú",
                description: "Audit trail for time modifications",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/time_edit_logs", desc: "Organization time edit logs" },
                    { method: "GET", path: "/v2/projects/{project_id}/time_edit_logs", desc: "Project time edit logs" }
                ],
                status: "supported"
            },
            insights: {
                title: "Insights & Smart Notifications",
                icon: "üîÆ",
                description: "Productivity insights and alerts",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/insights/smart_notification_rules", desc: "List notification rules" },
                    { method: "POST", path: "/v2/organizations/{organization_id}/insights/smart_notification_rules", desc: "Create rule" },
                    { method: "GET", path: "/v2/insights/smart_notification_rules/{rule_id}", desc: "Get rule" },
                    { method: "PUT", path: "/v2/insights/smart_notification_rules/{rule_id}", desc: "Update rule" },
                    { method: "DELETE", path: "/v2/insights/smart_notification_rules/{rule_id}", desc: "Delete rule" },
                    { method: "POST", path: "/v2/insights/smart_notification_rules/{rule_id}/toggle_status", desc: "Toggle rule status" },
                    { method: "PATCH", path: "/v2/insights/smart_notification_rules/{rule_id}/toggle_status", desc: "Toggle smart notification rule" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/insights/smart_notifications", desc: "List notifications" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/insights/unusual_activities", desc: "Unusual activities" }
                ],
                status: "supported"
            },
            globalTodos: {
                title: "Global To-Do's",
                icon: "üìå",
                description: "Organization-wide to-do items",
                endpoints: [
                    { method: "GET", path: "/v2/organizations/{organization_id}/global_todos", desc: "List global to-dos" },
                    { method: "POST", path: "/v2/organizations/{organization_id}/global_todos", desc: "Create global to-do" },
                    { method: "GET", path: "/v2/organizations/{organization_id}/global_todos/{id}", desc: "Get global to-do" },
                    { method: "PUT", path: "/v2/organizations/{organization_id}/global_todos/{id}", desc: "Update global to-do" },
                    { method: "DELETE", path: "/v2/organizations/{organization_id}/global_todos/{id}", desc: "Delete global to-do" }
                ],
                status: "supported"
            },
            errorCodes: {
                title: "Error Codes",
                icon: "‚ö†Ô∏è",
                description: "API error code reference",
                endpoints: [
                    { method: "GET", path: "/v2/error_codes", desc: "List all error codes" }
                ],
                status: "supported"
            },
            rateLimits: {
                title: "Rate Limits",
                icon: "‚ö°",
                description: "API request rate limiting",
                details: [
                    "350 requests per minute per token",
                    "Rate limit headers: X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset",
                    "429 Too Many Requests returned when exceeded",
                    "Use exponential backoff for retries"
                ],
                status: "info"
            },
            plans: {
                title: "API Plan Access",
                icon: "üìã",
                description: "Which Hubstaff plans include API access",
                details: [
                    "Starter: Limited/No API access",
                    "Team: Full API access included",
                    "Enterprise: Full API access with higher limits",
                    "API tokens managed in organization settings"
                ],
                status: "info"
            }
        };

        // =====================================================
        // HUBSTAFF TASKS API - tasks.hubstaff.com/api/v1
        // =====================================================
        const tasksApiKnowledge = {
            tasksAttachments: {
                title: "Attachments (Tasks API)",
                icon: "üìé",
                description: "View file attachments on tasks",
                endpoints: [
                    { method: "GET", path: "/v1/tasks/{task_id}/attachments", desc: "List all attachments for a task" }
                ],
                capabilities: ["View attachments", "List task files"],
                limitations: ["Read-only - cannot upload/delete attachments via API"]
            },
            tasksChecklists: {
                title: "Checklists (Tasks API)",
                icon: "‚òëÔ∏è",
                description: "View task checklists and their items",
                endpoints: [
                    { method: "GET", path: "/v1/checklists/{checklist_id}", desc: "Get a specific checklist" },
                    { method: "GET", path: "/v1/checklists/{checklist_id}/items", desc: "List items in a checklist" },
                    { method: "GET", path: "/v1/tasks/{task_id}/checklists", desc: "List all checklists for a task" }
                ],
                capabilities: ["View checklists", "View checklist items"],
                limitations: ["Read-only - cannot create/update/delete checklists via API"]
            },
            tasksComments: {
                title: "Comments (Tasks API)",
                icon: "üí¨",
                description: "Add comments and discussions to tasks",
                endpoints: [
                    { method: "GET", path: "/v1/tasks/{task_id}/comments", desc: "List all comments on a task" },
                    { method: "POST", path: "/v1/tasks/{task_id}/comments", desc: "Add a comment to a task" }
                ],
                capabilities: ["View comments", "Add new comments"],
                limitations: ["Cannot edit or delete existing comments via API"]
            },
            tasksFolders: {
                title: "Folders (Tasks API)",
                icon: "üìÇ",
                description: "Organize projects into folders",
                endpoints: [
                    { method: "GET", path: "/v1/folders", desc: "List all folders" },
                    { method: "GET", path: "/v1/folders/{folder_id}", desc: "Get a specific folder" },
                    { method: "GET", path: "/v1/organizations/{organization_id}/folders", desc: "List folders in an organization" },
                    { method: "POST", path: "/v1/organizations/{organization_id}/folders", desc: "Create a new folder" }
                ],
                capabilities: ["List folders", "View folder details", "Create folders"],
                limitations: ["Cannot update or delete folders via API"]
            },
            tasksLabels: {
                title: "Labels (Tasks API)",
                icon: "üè∑Ô∏è",
                description: "Categorize tasks with color-coded labels",
                endpoints: [
                    { method: "GET", path: "/v1/projects/{project_id}/labels", desc: "List all labels in a project" },
                    { method: "POST", path: "/v1/projects/{project_id}/labels", desc: "Create a new label" }
                ],
                capabilities: ["View labels", "Create labels"],
                limitations: ["Cannot update or delete labels via API"]
            },
            tasksLists: {
                title: "Lists (Tasks API)",
                icon: "üìë",
                description: "Organize tasks into lists (like Kanban columns)",
                endpoints: [
                    { method: "GET", path: "/v1/lists/{list_id}", desc: "Get a specific list" },
                    { method: "GET", path: "/v1/projects/{project_id}/lists", desc: "List all lists in a project" },
                    { method: "POST", path: "/v1/projects/{project_id}/lists", desc: "Create a new list" }
                ],
                capabilities: ["View lists", "Create lists"],
                limitations: ["Cannot update or delete lists via API"]
            },
            tasksMembers: {
                title: "Members (Tasks API)",
                icon: "üë§",
                description: "View organization members and their roles",
                endpoints: [
                    { method: "GET", path: "/v1/members/me", desc: "Get current authenticated member" },
                    { method: "GET", path: "/v1/members/{member_id}", desc: "Get a specific member" },
                    { method: "GET", path: "/v1/organizations/{organization_id}/members", desc: "List members in an organization" },
                    { method: "GET", path: "/v1/projects/{project_id}/members", desc: "List members in a project" }
                ],
                capabilities: ["View member details", "List organization members", "List project members"],
                limitations: ["Read-only - cannot add/remove/update members via API"]
            },
            tasksOrganizations: {
                title: "Organizations (Tasks API)",
                icon: "üè¢",
                description: "View organizations and their settings",
                endpoints: [
                    { method: "GET", path: "/v1/organizations", desc: "List all organizations" },
                    { method: "GET", path: "/v1/organizations/{organization_id}", desc: "Get a specific organization" }
                ],
                capabilities: ["View organizations", "View organization details"],
                limitations: ["Read-only - cannot create/update organizations via API"]
            },
            tasksProjects: {
                title: "Projects (Tasks API)",
                icon: "üìÅ",
                description: "Create and manage projects for task organization",
                endpoints: [
                    { method: "GET", path: "/v1/projects", desc: "List all projects" },
                    { method: "GET", path: "/v1/projects/{project_id}", desc: "Get a specific project" },
                    { method: "GET", path: "/v1/folders/{folder_id}/projects", desc: "List projects in a folder" },
                    { method: "POST", path: "/v1/folders/{folder_id}/projects", desc: "Create a project in a folder" },
                    { method: "GET", path: "/v1/organizations/{organization_id}/projects", desc: "List projects in an organization" }
                ],
                capabilities: ["List projects", "View project details", "Create projects in folders"],
                limitations: ["Cannot update or delete projects via API"]
            },
            tasksTasks: {
                title: "Tasks (Tasks API)",
                icon: "‚úÖ",
                description: "Create, update, and track tasks",
                endpoints: [
                    { method: "GET", path: "/v1/tasks/{task_id}", desc: "Get a specific task" },
                    { method: "PATCH", path: "/v1/tasks/{task_id}", desc: "Update a task" },
                    { method: "PATCH", path: "/v1/tasks/{task_id}/complete", desc: "Mark a task as complete" },
                    { method: "GET", path: "/v1/tasks/my/assigned", desc: "List tasks assigned to current user" },
                    { method: "GET", path: "/v1/lists/{list_id}/tasks", desc: "List tasks in a list" },
                    { method: "POST", path: "/v1/lists/{list_id}/tasks", desc: "Create a task in a list" },
                    { method: "GET", path: "/v1/projects/{project_id}/tasks", desc: "List tasks in a project" }
                ],
                capabilities: ["Create tasks", "Update tasks", "Complete tasks", "View assigned tasks"],
                limitations: ["Cannot delete tasks via API"]
            },
            tasksTimeEntries: {
                title: "Time Entries (Tasks API)",
                icon: "‚è±Ô∏è",
                description: "Track time spent on tasks",
                endpoints: [
                    { method: "GET", path: "/v1/tasks/{task_id}/time_entries", desc: "List time entries for a task" },
                    { method: "POST", path: "/v1/tasks/{task_id}/time_entries", desc: "Create a time entry for a task" }
                ],
                capabilities: ["View time entries", "Log time to tasks"],
                limitations: ["Cannot update or delete time entries via API"]
            }
        };

        // =====================================================
        // DEVELOPER RESOURCES & GUIDES
        // =====================================================
        const developerResources = {
            officialDocs: {
                title: "Official Documentation",
                icon: "üìñ",
                links: [
                    { name: "API Documentation", url: "https://developer.hubstaff.com/", desc: "Interactive API docs with endpoint explorer" },
                    { name: "Authentication Guide", url: "https://developer.hubstaff.com/authentication", desc: "OAuth 2.0 and token setup instructions" }
                ]
            },
            codeExamples: {
                title: "Official Code Examples",
                icon: "üíª",
                links: [
                    { name: "Node.js Demo", url: "https://github.com/NetsoftHoldings/public-api-nodejs-demo", desc: "Express.js app using openid-client package" },
                    { name: "PHP Demo", url: "https://github.com/NetsoftHoldings/public-api-php-demo", desc: "CLI tool using php-openid-client" },
                    { name: "Postman Collection", url: "https://github.com/NetsoftHoldings/public-api-postman", desc: "Ready-to-use Postman collection for testing" }
                ]
            },
            authSpecs: {
                title: "Authentication Standards",
                icon: "üîê",
                links: [
                    { name: "OpenID Connect Specs", url: "https://openid.net/specs/", desc: "OIDC protocol specification" },
                    { name: "JWT.io", url: "https://jwt.io/", desc: "JWT debugger and library reference" },
                    { name: "OAuth 2.0 RFC", url: "https://tools.ietf.org/html/rfc6749", desc: "OAuth 2.0 authorization framework" }
                ]
            },
            keyEndpoints: {
                title: "Key API Endpoints",
                icon: "üåê",
                links: [
                    { name: "API Base URL", url: "https://api.hubstaff.com/", desc: "Main API endpoint (v2)" },
                    { name: "Account/Auth Domain", url: "https://account.hubstaff.com/", desc: "OpenID Connect discovery endpoint" },
                    { name: "Tasks API Base URL", url: "https://tasks.hubstaff.com/api/", desc: "Hubstaff Tasks API (v1)" }
                ]
            },
            tokenInfo: {
                title: "Token Management",
                icon: "üé´",
                details: [
                    "Personal Access Tokens (PAT) generate short-lived access tokens",
                    "Access tokens must be refreshed periodically using refresh_token",
                    "Store refresh_token securely - it's long-lived",
                    "Use OpenID Connect discovery to get token endpoints automatically",
                    "Discovery URL: https://account.hubstaff.com/.well-known/openid-configuration"
                ]
            },
            configExample: {
                title: "Token Config Example",
                icon: "‚öôÔ∏è",
                code: `{
    "token": {
        "refresh_token": "your_personal_access_token_here"
    }
}`
            }
        };

        function renderKnowledgeBase() {
            const grid = document.getElementById('kbGrid');
            grid.innerHTML = Object.entries(apiKnowledge).map(([key, item]) => `
                <div class="kb-item" onclick="quickSearch('${item.title.toLowerCase()}')">
                    <div class="kb-item-title">
                        <span>${item.icon}</span>
                        <span>${item.title}</span>
                    </div>
                    <div class="kb-item-desc">${item.description}</div>
                </div>
            `).join('');
        }

        function toggleKnowledgeBase() {
            const content = document.getElementById('kbContent');
            const toggle = document.getElementById('kbToggle');
            content.classList.toggle('open');
            toggle.textContent = content.classList.contains('open') ? '‚ñ≤' : '‚ñº';
        }

        function quickSearch(query) {
            document.getElementById('searchInput').value = query;
            handleSearch();
        }

        function handleSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (!query.trim()) return;

            const results = analyzeQuery(query);
            displayResults(results, query);
        }

        function analyzeQuery(query) {
            const results = {
                matches: [],
                summary: "",
                relatedTopics: []
            };

            // Keyword mapping for better matching
            const keywordMap = {
                'timesheet': ['timesheets', 'activities', 'timeEntries'],
                'time': ['timesheets', 'activities', 'timeEntries', 'timeEditLogs'],
                'tracking': ['activities', 'timesheets', 'screenshots', 'toolUsages'],
                'attendance': ['attendance', 'jobSiteVisits', 'jobSites'],
                'check-in': ['jobSiteVisits', 'attendance'],
                'check-out': ['jobSiteVisits', 'attendance'],
                'checkin': ['jobSiteVisits', 'attendance'],
                'checkout': ['jobSiteVisits', 'attendance'],
                'project': ['projects', 'tasks'],
                'task': ['tasks', 'globalTodos'],
                'user': ['users', 'members'],
                'member': ['members', 'teams', 'invites'],
                'team': ['teams', 'members'],
                'screenshot': ['screenshots'],
                'location': ['locations', 'jobSites', 'jobSiteVisits'],
                'gps': ['locations', 'jobSites'],
                'geofence': ['jobSites', 'jobSiteVisits'],
                'webhook': ['webhooks'],
                'notification': ['webhooks', 'insights'],
                'auth': ['authentication'],
                'oauth': ['authentication'],
                'token': ['authentication'],
                'rate': ['rateLimits', 'rates'],
                'limit': ['rateLimits', 'limits'],
                'erp': ['timesheets', 'activities', 'projects', 'tasks', 'users'],
                'sync': ['timesheets', 'activities', 'webhooks', 'projects', 'tasks'],
                'integration': ['integrations', 'webhooks'],
                'odoo': ['timesheets', 'activities', 'projects', 'attendance'],
                'payroll': ['timesheets', 'payments', 'invoices'],
                'invoice': ['invoices', 'payments'],
                'payment': ['payments', 'invoices'],
                'budget': ['budgets', 'rates'],
                'client': ['clients', 'invoices'],
                'report': ['activities', 'timesheets', 'screenshots'],
                'plan': ['plans', 'rateLimits'],
                'pricing': ['plans'],
                'monitor': ['screenshots', 'toolUsages', 'insights'],
                'app': ['toolUsages'],
                'website': ['toolUsages'],
                'holiday': ['holidays', 'timeOff'],
                'leave': ['timeOff', 'holidays'],
                'pto': ['timeOff'],
                'vacation': ['timeOff', 'holidays'],
                // Tasks API keywords
                'tasks api': ['tasksTasks', 'tasksProjects', 'tasksLists'],
                'hubstaff tasks': ['tasksTasks', 'tasksProjects', 'tasksLists'],
                'checklist': ['tasksChecklists'],
                'task comment': ['tasksComments'],
                'task label': ['tasksLabels'],
                'kanban': ['tasksLists', 'tasksTasks'],
                'task list': ['tasksLists'],
                'task folder': ['tasksFolders'],
                'complete task': ['tasksTasks'],
                'assigned tasks': ['tasksTasks'],
                // Developer resources keywords
                'code example': ['developerResources'],
                'sample code': ['developerResources'],
                'node': ['developerResources'],
                'nodejs': ['developerResources'],
                'php': ['developerResources'],
                'postman': ['developerResources'],
                'jwt': ['developerResources', 'authentication'],
                'openid': ['developerResources', 'authentication'],
                'oidc': ['developerResources', 'authentication'],
                'discovery': ['developerResources', 'authentication'],
                'refresh token': ['developerResources', 'authentication'],
                'access token': ['developerResources', 'authentication'],
                'developer': ['developerResources'],
                'getting started': ['developerResources', 'authentication'],
                'setup': ['developerResources', 'authentication'],
                'example': ['developerResources']
            };

            // Find matching categories
            const matchedCategories = new Set();
            
            Object.entries(keywordMap).forEach(([keyword, categories]) => {
                if (query.includes(keyword)) {
                    categories.forEach(cat => matchedCategories.add(cat));
                }
            });

            // Also check Tasks API knowledge
            Object.entries(tasksApiKnowledge).forEach(([key, data]) => {
                const titleMatch = data.title && data.title.toLowerCase().includes(query);
                const descMatch = data.description && data.description.toLowerCase().includes(query);
                if (titleMatch || descMatch) {
                    matchedCategories.add(key);
                }
            });

            // Also do direct matching on category names
            Object.keys(apiKnowledge).forEach(key => {
                const item = apiKnowledge[key];
                if (item.title.toLowerCase().includes(query) || 
                    item.description.toLowerCase().includes(query) ||
                    query.includes(item.title.toLowerCase())) {
                    matchedCategories.add(key);
                }
            });

            // If no matches, show general info
            if (matchedCategories.size === 0) {
                matchedCategories.add('authentication');
                matchedCategories.add('rateLimits');
                matchedCategories.add('plans');
            }

            matchedCategories.forEach(cat => {
                if (apiKnowledge[cat]) {
                    results.matches.push(apiKnowledge[cat]);
                }
            });

            // Generate summary based on query
            results.summary = generateSummary(query, results.matches);
            results.relatedTopics = getRelatedTopics(matchedCategories);

            return results;
        }

        function checkCanDo(query) {
            // Normalize the query
            const q = query.toLowerCase();
            
            // Define capabilities with clear YES/NO answers
            const capabilities = {
                // Main API - YES capabilities
                'create project': { answer: 'YES', api: 'Main API', endpoint: 'POST /v2/organizations/{org_id}/projects', note: 'Full CRUD supported for projects' },
                'update project': { answer: 'YES', api: 'Main API', endpoint: 'PUT /v2/projects/{project_id}', note: 'Can update name, description, status' },
                'delete project': { answer: 'NO', api: 'Main API', endpoint: null, note: 'Projects cannot be deleted via API - archive instead' },
                'create task': { answer: 'YES', api: 'Main API', endpoint: 'POST /v2/projects/{project_id}/tasks', note: 'Full CRUD supported for tasks' },
                'update task': { answer: 'YES', api: 'Main API', endpoint: 'PUT /v2/tasks/{task_id}', note: 'Can update all task fields' },
                'delete task': { answer: 'YES', api: 'Main API', endpoint: 'DELETE /v2/tasks/{task_id}', note: 'Tasks can be deleted' },
                'get timesheet': { answer: 'YES', api: 'Main API', endpoint: 'GET /v2/organizations/{org_id}/timesheets', note: 'Read-only access to aggregated time data' },
                'create timesheet': { answer: 'NO', api: 'Main API', endpoint: null, note: 'Timesheets are generated from tracked time - cannot create directly' },
                'edit time': { answer: 'NO', api: 'Main API', endpoint: null, note: 'Time entries cannot be created/edited via API - only read' },
                'get screenshot': { answer: 'YES', api: 'Main API', endpoint: 'GET /v2/organizations/{org_id}/screenshots', note: 'Can retrieve screenshot URLs and metadata' },
                'delete screenshot': { answer: 'NO', api: 'Main API', endpoint: null, note: 'Screenshots cannot be deleted via API' },
                'create webhook': { answer: 'YES', api: 'Main API', endpoint: 'POST /v2/organizations/{org_id}/webhooks', note: 'Supports real-time notifications' },
                'delete webhook': { answer: 'YES', api: 'Main API', endpoint: 'DELETE /v2/webhooks/{webhook_id}', note: 'Webhooks can be removed' },
                'create team': { answer: 'YES', api: 'Main API', endpoint: 'POST /v2/organizations/{org_id}/teams', note: 'Full CRUD for teams' },
                'delete team': { answer: 'YES', api: 'Main API', endpoint: 'DELETE /v2/teams/{team_id}', note: 'Teams can be deleted' },
                'create user': { answer: 'NO', api: 'Main API', endpoint: null, note: 'Use Invites API to add users - POST /v2/organizations/{org_id}/invites' },
                'invite user': { answer: 'YES', api: 'Main API', endpoint: 'POST /v2/organizations/{org_id}/invites', note: 'Can send invites, including bulk invites' },
                'remove user': { answer: 'YES', api: 'Main API', endpoint: 'PUT /v2/organizations/{org_id}/update_members', note: 'Update member status to remove' },
                'create client': { answer: 'YES', api: 'Main API', endpoint: 'POST /v2/organizations/{org_id}/clients', note: 'Can create and update clients' },
                'delete client': { answer: 'NO', api: 'Main API', endpoint: null, note: 'Clients cannot be deleted via API' },
                'get attendance': { answer: 'YES', api: 'Main API', endpoint: 'GET /v2/organizations/{org_id}/attendance_shifts', note: 'Attendance derived from activity times' },
                'check in': { answer: 'INDIRECT', api: 'Main API', endpoint: 'GET /v2/organizations/{org_id}/job_site_visits', note: 'Use Job Site Visits for GPS-based check-in/out' },
                'check out': { answer: 'INDIRECT', api: 'Main API', endpoint: 'GET /v2/organizations/{org_id}/job_site_visits', note: 'Use Job Site Visits for GPS-based check-in/out' },
                'create job site': { answer: 'YES', api: 'Main API', endpoint: 'POST /v2/organizations/{org_id}/job_sites', note: 'Can create geofenced locations' },
                'get location': { answer: 'YES', api: 'Main API', endpoint: 'GET /v2/organizations/{org_id}/locations', note: 'GPS location data available' },
                'track location': { answer: 'YES', api: 'Main API', endpoint: 'GET /v2/organizations/{org_id}/locations', note: 'GPS tracking data from mobile app' },
                'get activity': { answer: 'YES', api: 'Main API', endpoint: 'GET /v2/organizations/{org_id}/activities', note: 'Full activity data with productivity metrics' },
                'get time off': { answer: 'YES', api: 'Main API', endpoint: 'GET /v2/organizations/{org_id}/time_off_requests', note: 'Read-only access to PTO data' },
                'create time off': { answer: 'NO', api: 'Main API', endpoint: null, note: 'Time off requests managed in Hubstaff UI only' },
                'get invoice': { answer: 'YES', api: 'Main API', endpoint: 'GET /v2/organizations/{org_id}/client_invoices', note: 'Read-only access to invoices' },
                'create invoice': { answer: 'NO', api: 'Main API', endpoint: null, note: 'Invoices created in Hubstaff UI only' },
                'sync payroll': { answer: 'YES', api: 'Main API', endpoint: 'GET /v2/organizations/{org_id}/timesheets', note: 'Export timesheet data for payroll systems' },
                'integrate erp': { answer: 'YES', api: 'Main API', endpoint: 'Multiple endpoints', note: 'Full API access on Team/Enterprise plans' },
                'integrate odoo': { answer: 'YES', api: 'Main API', endpoint: 'Multiple endpoints', note: 'Timesheets, projects, tasks all accessible' },

                // Tasks API capabilities
                'create task tasks api': { answer: 'YES', api: 'Tasks API', endpoint: 'POST /v1/lists/{list_id}/tasks', note: 'Create tasks in lists' },
                'complete task': { answer: 'YES', api: 'Tasks API', endpoint: 'PATCH /v1/tasks/{task_id}/complete', note: 'Mark tasks as complete' },
                'delete task tasks api': { answer: 'NO', api: 'Tasks API', endpoint: null, note: 'Tasks cannot be deleted via Tasks API' },
                'add comment': { answer: 'YES', api: 'Tasks API', endpoint: 'POST /v1/tasks/{task_id}/comments', note: 'Can add comments to tasks' },
                'delete comment': { answer: 'NO', api: 'Tasks API', endpoint: null, note: 'Comments cannot be edited or deleted via API' },
                'create checklist': { answer: 'NO', api: 'Tasks API', endpoint: null, note: 'Checklists are read-only via API' },
                'view checklist': { answer: 'YES', api: 'Tasks API', endpoint: 'GET /v1/tasks/{task_id}/checklists', note: 'Can view checklists and items' },
                'create folder': { answer: 'YES', api: 'Tasks API', endpoint: 'POST /v1/organizations/{org_id}/folders', note: 'Can create folders' },
                'delete folder': { answer: 'NO', api: 'Tasks API', endpoint: null, note: 'Folders cannot be deleted via API' },
                'create label': { answer: 'YES', api: 'Tasks API', endpoint: 'POST /v1/projects/{project_id}/labels', note: 'Can create labels' },
                'delete label': { answer: 'NO', api: 'Tasks API', endpoint: null, note: 'Labels cannot be deleted via API' },
                'create list': { answer: 'YES', api: 'Tasks API', endpoint: 'POST /v1/projects/{project_id}/lists', note: 'Can create Kanban lists' },
                'delete list': { answer: 'NO', api: 'Tasks API', endpoint: null, note: 'Lists cannot be deleted via API' },
                'log time': { answer: 'YES', api: 'Tasks API', endpoint: 'POST /v1/tasks/{task_id}/time_entries', note: 'Can log time to tasks' },
                'delete time entry': { answer: 'NO', api: 'Tasks API', endpoint: null, note: 'Time entries cannot be deleted via Tasks API' },
                'upload attachment': { answer: 'NO', api: 'Tasks API', endpoint: null, note: 'Attachments are read-only via API' },
                'view attachment': { answer: 'YES', api: 'Tasks API', endpoint: 'GET /v1/tasks/{task_id}/attachments', note: 'Can view attachment list' },
                'assign task': { answer: 'YES', api: 'Tasks API', endpoint: 'PATCH /v1/tasks/{task_id}', note: 'Update task to change assignee' },
                'get assigned tasks': { answer: 'YES', api: 'Tasks API', endpoint: 'GET /v1/tasks/my/assigned', note: 'View tasks assigned to current user' },

                // Developer resource capabilities
                'use postman': { answer: 'YES', api: 'Tools', endpoint: 'github.com/NetsoftHoldings/public-api-postman', note: 'Official Postman collection available for API testing' },
                'use nodejs': { answer: 'YES', api: 'Tools', endpoint: 'github.com/NetsoftHoldings/public-api-nodejs-demo', note: 'Official Node.js demo with openid-client' },
                'use php': { answer: 'YES', api: 'Tools', endpoint: 'github.com/NetsoftHoldings/public-api-php-demo', note: 'Official PHP demo available' },
                'refresh token': { answer: 'YES', api: 'Main API', endpoint: 'POST /oauth/token', note: 'Use refresh_token grant type to get new access tokens' },
                'get access token': { answer: 'YES', api: 'Main API', endpoint: 'POST /oauth/token', note: 'Exchange refresh_token for short-lived access token' },
            };

            // Check for matches
            for (const [key, data] of Object.entries(capabilities)) {
                if (q.includes(key) || key.split(' ').every(word => q.includes(word))) {
                    return data;
                }
            }

            // Fuzzy matching for common variations
            const fuzzyMatches = [
                { patterns: ['create', 'add', 'new', 'make'], subject: 'project', key: 'create project' },
                { patterns: ['create', 'add', 'new', 'make'], subject: 'task', key: 'create task' },
                { patterns: ['delete', 'remove', 'destroy'], subject: 'project', key: 'delete project' },
                { patterns: ['delete', 'remove', 'destroy'], subject: 'task', key: 'delete task' },
                { patterns: ['edit', 'update', 'modify', 'change'], subject: 'project', key: 'update project' },
                { patterns: ['edit', 'update', 'modify', 'change'], subject: 'task', key: 'update task' },
                { patterns: ['get', 'view', 'see', 'read', 'fetch', 'retrieve', 'export'], subject: 'timesheet', key: 'get timesheet' },
                { patterns: ['get', 'view', 'see', 'read', 'fetch', 'retrieve'], subject: 'screenshot', key: 'get screenshot' },
                { patterns: ['create', 'add', 'set up', 'setup'], subject: 'webhook', key: 'create webhook' },
                { patterns: ['invite', 'add'], subject: 'user', key: 'invite user' },
                { patterns: ['check', 'clock'], subject: 'in', key: 'check in' },
                { patterns: ['check', 'clock'], subject: 'out', key: 'check out' },
                { patterns: ['complete', 'finish', 'done', 'close'], subject: 'task', key: 'complete task' },
                { patterns: ['comment', 'add comment', 'post comment'], subject: 'task', key: 'add comment' },
                { patterns: ['sync', 'integrate', 'connect', 'export'], subject: 'payroll', key: 'sync payroll' },
                { patterns: ['sync', 'integrate', 'connect'], subject: 'erp', key: 'integrate erp' },
                { patterns: ['sync', 'integrate', 'connect'], subject: 'odoo', key: 'integrate odoo' },
                { patterns: ['track', 'get', 'view'], subject: 'location', key: 'track location' },
                { patterns: ['track', 'get', 'view'], subject: 'gps', key: 'track location' },
                { patterns: ['log', 'track', 'add', 'record'], subject: 'time', key: 'log time' },
                { patterns: ['assign'], subject: 'task', key: 'assign task' },
            ];

            for (const match of fuzzyMatches) {
                const hasPattern = match.patterns.some(p => q.includes(p));
                const hasSubject = q.includes(match.subject);
                if (hasPattern && hasSubject && capabilities[match.key]) {
                    return capabilities[match.key];
                }
            }

            return null;
        }

        function generateSummary(query, matches) {
            let summary = "";

            // Check for "Can the customer do X?" type questions
            const isCanQuestion = query.includes('can ') || query.includes('able to') || query.includes('possible') || query.includes('does') || query.includes('is it possible');
            const canDoResult = checkCanDo(query);

            if (isCanQuestion && canDoResult) {
                const statusClass = canDoResult.answer === 'YES' ? 'status-supported' : 
                                   canDoResult.answer === 'NO' ? 'status-unavailable' : 'status-indirect';
                const statusIcon = canDoResult.answer === 'YES' ? '‚úÖ' : 
                                  canDoResult.answer === 'NO' ? '‚ùå' : '‚ö†Ô∏è';
                const boxClass = canDoResult.answer === 'YES' ? 'success' : 
                                canDoResult.answer === 'NO' ? 'warning' : 'warning';

                summary = `
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <span class="status-badge ${statusClass}" style="font-size: 1.5rem; padding: 0.75rem 2rem;">
                            ${statusIcon} ${canDoResult.answer}
                        </span>
                    </div>
                    <div class="info-box ${boxClass}">
                        <span class="info-icon">${statusIcon}</span>
                        <div class="info-content">
                            <strong>API:</strong> ${canDoResult.api}<br>
                            ${canDoResult.endpoint ? `<strong>Endpoint:</strong> <code style="background: var(--bg-dark); padding: 2px 6px; border-radius: 4px;">${canDoResult.endpoint}</code><br>` : ''}
                            <strong>Note:</strong> ${canDoResult.note}
                        </div>
                    </div>
                `;
                return summary;
            }

            // ERP/Odoo integration query
            if (query.includes('erp') || query.includes('odoo') || query.includes('integration')) {
                summary = `<p><strong>Yes, the Hubstaff API is available for third-party ERP integrations</strong> like Odoo.</p>
                <div class="info-box success">
                    <span class="info-icon">‚úÖ</span>
                    <div class="info-content">
                        <strong>API Access Plans:</strong> Team and Enterprise plans include full API access. Starter plans have limited or no API access.
                    </div>
                </div>
                <p><strong>What you can sync:</strong></p>
                <ul style="color: var(--text-secondary); margin-left: 1.5rem; line-height: 2;">
                    <li><span class="status-badge status-supported">‚úì Supported</span> <strong>Timesheets & Work Hours</strong> - Full access via /v2/timesheets and /v2/activities endpoints</li>
                    <li><span class="status-badge status-supported">‚úì Supported</span> <strong>Projects & Tasks</strong> - Full CRUD operations available</li>
                    <li><span class="status-badge status-supported">‚úì Supported</span> <strong>Users & Members</strong> - Read access to user data</li>
                    <li><span class="status-badge status-indirect">~ Indirect</span> <strong>Attendance</strong> - Derived from activity start/stop times. For explicit check-in/check-out, use Job Site Visits API with geofencing.</li>
                </ul>
                <div class="info-box warning">
                    <span class="info-icon">‚ö†Ô∏è</span>
                    <div class="info-content">
                        <strong>Rate Limit:</strong> 350 requests per minute. Use X-RateLimit headers to track usage.
                    </div>
                </div>`;
            }
            // Attendance query
            else if (query.includes('attendance') || query.includes('check-in') || query.includes('check-out') || query.includes('checkin') || query.includes('checkout')) {
                summary = `<p><strong>Attendance tracking in Hubstaff works in two ways:</strong></p>
                <div class="info-box success">
                    <span class="info-icon">‚úÖ</span>
                    <div class="info-content">
                        <strong>Option 1 - Activity-Based:</strong> Attendance is derived from the first and last activity timestamps each day. Use the Activities API to get this data.
                    </div>
                </div>
                <div class="info-box success">
                    <span class="info-icon">‚úÖ</span>
                    <div class="info-content">
                        <strong>Option 2 - Job Site Visits (Geofencing):</strong> For explicit check-in/check-out, use the Job Sites and Job Site Visits APIs. This provides GPS-based arrival/departure tracking at defined locations.
                    </div>
                </div>
                <p>The <strong>Attendance Schedules API</strong> lets you define expected work hours, and <strong>Attendance Shifts</strong> track actual working periods.</p>`;
            }
            // Time tracking query
            else if (query.includes('time') || query.includes('tracking') || query.includes('timesheet')) {
                summary = `<p><strong>Hubstaff provides comprehensive time tracking data via the API:</strong></p>
                <ul style="color: var(--text-secondary); margin-left: 1.5rem; line-height: 2;">
                    <li><strong>Activities</strong> - Granular time tracking with keyboard/mouse activity levels</li>
                    <li><strong>Timesheets</strong> - Aggregated time data for reporting and payroll</li>
                    <li><strong>Time Entries</strong> - Individual start/stop time records</li>
                    <li><strong>Daily Summaries</strong> - Pre-aggregated daily totals</li>
                </ul>
                <p>All endpoints support date range filtering and can be scoped by organization or project.</p>`;
            }
            // Webhooks query
            else if (query.includes('webhook') || query.includes('notification') || query.includes('real-time')) {
                summary = `<p><strong>Webhooks enable real-time event notifications:</strong></p>
                <div class="info-box success">
                    <span class="info-icon">‚úÖ</span>
                    <div class="info-content">
                        Create webhooks at organization, project, or user level. Events include time entries, activities, screenshots, project/task changes, and user updates.
                    </div>
                </div>
                <p><strong>Setup process:</strong></p>
                <ol style="color: var(--text-secondary); margin-left: 1.5rem; line-height: 2;">
                    <li>POST to /v2/organizations/{org_id}/webhooks with your endpoint URL</li>
                    <li>Hubstaff sends a verification POST with x-hs-verification header</li>
                    <li>Return the verification token to confirm</li>
                    <li>Activate the webhook via /v2/webhooks/{id}/activate</li>
                </ol>`;
            }
            // Authentication query
            else if (query.includes('auth') || query.includes('oauth') || query.includes('token')) {
                summary = `<p><strong>Hubstaff supports multiple authentication methods:</strong></p>
                <ul style="color: var(--text-secondary); margin-left: 1.5rem; line-height: 2;">
                    <li><strong>OAuth 2.0</strong> - For third-party applications requiring user authorization</li>
                    <li><strong>Personal Access Tokens (PAT)</strong> - For direct API access by account owners</li>
                    <li><strong>App Tokens</strong> - For server-to-server integrations</li>
                </ul>
                <p>All requests require a Bearer token in the Authorization header.</p>`;
            }
            // Rate limits query
            else if (query.includes('rate') || query.includes('limit')) {
                summary = `<p><strong>API Rate Limiting:</strong></p>
                <div class="info-box warning">
                    <span class="info-icon">‚ö°</span>
                    <div class="info-content">
                        <strong>350 requests per minute</strong> per authentication token
                    </div>
                </div>
                <p>Monitor your usage with response headers:</p>
                <ul style="color: var(--text-secondary); margin-left: 1.5rem; line-height: 2;">
                    <li><code style="background: var(--bg-dark); padding: 2px 6px; border-radius: 4px;">X-RateLimit-Limit</code> - Maximum requests allowed</li>
                    <li><code style="background: var(--bg-dark); padding: 2px 6px; border-radius: 4px;">X-RateLimit-Remaining</code> - Requests remaining in window</li>
                    <li><code style="background: var(--bg-dark); padding: 2px 6px; border-radius: 4px;">X-RateLimit-Reset</code> - Timestamp when limit resets</li>
                </ul>
                <p>Use exponential backoff when receiving 429 Too Many Requests responses.</p>`;
            }
            // Plan/pricing query
            else if (query.includes('plan') || query.includes('pricing') || query.includes('subscription')) {
                summary = `<p><strong>API Access by Plan:</strong></p>
                <ul style="color: var(--text-secondary); margin-left: 1.5rem; line-height: 2;">
                    <li><span class="status-badge status-unavailable">‚úó</span> <strong>Starter</strong> - Limited or no API access</li>
                    <li><span class="status-badge status-supported">‚úì</span> <strong>Team</strong> - Full API access included</li>
                    <li><span class="status-badge status-supported">‚úì</span> <strong>Enterprise</strong> - Full API access with potential for higher rate limits</li>
                </ul>
                <p>API tokens are managed in the organization settings by account administrators.</p>`;
            }
                // Developer resources query
            else if (query.includes('developer') || query.includes('example') || query.includes('code') || query.includes('postman') || query.includes('node') || query.includes('php') || query.includes('getting started') || query.includes('setup') || query.includes('jwt') || query.includes('openid')) {
                summary = `<p><strong>Developer Resources for Hubstaff API Integration:</strong></p>
                <div class="info-box success">
                    <span class="info-icon">üìñ</span>
                    <div class="info-content">
                        <strong>Official Documentation:</strong><br>
                        ‚Ä¢ <a href="https://developer.hubstaff.com/" target="_blank" style="color: var(--primary);">API Docs & Interactive Explorer</a><br>
                        ‚Ä¢ <a href="https://developer.hubstaff.com/authentication" target="_blank" style="color: var(--primary);">Authentication Guide</a>
                    </div>
                </div>
                <div class="info-box">
                    <span class="info-icon">üíª</span>
                    <div class="info-content">
                        <strong>Official Code Examples:</strong><br>
                        ‚Ä¢ <a href="https://github.com/NetsoftHoldings/public-api-nodejs-demo" target="_blank" style="color: var(--accent-blue);">Node.js Demo</a> - Express.js with openid-client<br>
                        ‚Ä¢ <a href="https://github.com/NetsoftHoldings/public-api-php-demo" target="_blank" style="color: var(--accent-blue);">PHP Demo</a> - CLI tool with php-openid-client<br>
                        ‚Ä¢ <a href="https://github.com/NetsoftHoldings/public-api-postman" target="_blank" style="color: var(--accent-blue);">Postman Collection</a> - Ready for API testing
                    </div>
                </div>
                <div class="info-box warning">
                    <span class="info-icon">üîê</span>
                    <div class="info-content">
                        <strong>Key URLs:</strong><br>
                        ‚Ä¢ API Base: <code style="background: var(--bg-dark); padding: 2px 6px; border-radius: 4px;">https://api.hubstaff.com/v2/</code><br>
                        ‚Ä¢ Auth Domain: <code style="background: var(--bg-dark); padding: 2px 6px; border-radius: 4px;">https://account.hubstaff.com/</code><br>
                        ‚Ä¢ OpenID Discovery: <code style="background: var(--bg-dark); padding: 2px 6px; border-radius: 4px;">https://account.hubstaff.com/.well-known/openid-configuration</code>
                    </div>
                </div>
                <p><strong>Token Setup:</strong> Create a <code style="background: var(--bg-dark); padding: 2px 6px; border-radius: 4px;">configState.json</code> with your refresh_token. The demos auto-refresh access tokens as needed.</p>`;
            }
            // Default summary
            else {
                summary = `<p>Based on your query, here are the relevant Hubstaff API capabilities:</p>`;
                if (matches.length > 0) {
                    summary += `<p>Found <strong>${matches.length} relevant API categories</strong> that may help with your integration.</p>`;
                }
            }

            return summary;
        }

        function getRelatedTopics(matchedCategories) {
            const allTopics = Object.keys(apiKnowledge).filter(k => !matchedCategories.has(k));
            return allTopics.slice(0, 6).map(k => apiKnowledge[k].title);
        }

        function displayResults(results, query) {
            const section = document.getElementById('resultsSection');
            document.getElementById('emptyState').style.display = 'none';

            let html = `
                <div class="answer-card">
                    <div class="answer-header">
                        <div class="answer-icon">üí°</div>
                        <div class="answer-title">API Capability Analysis</div>
                    </div>
                    <div class="answer-content">
                        ${results.summary}
                    </div>
                    <button class="copy-btn" onclick="copyAnswer()">
                        <span>üìã</span>
                        <span>Copy Response</span>
                    </button>
                </div>
            `;

            // Show matched endpoints
            if (results.matches.length > 0) {
                results.matches.forEach(match => {
                    if (match.endpoints && match.endpoints.length > 0) {
                        html += `
                            <div class="category-section">
                                <div class="category-header" onclick="toggleCategory(this)">
                                    <div class="category-icon">${match.icon}</div>
                                    <div class="category-title">${match.title}</div>
                                    <div class="category-count">${match.endpoints.length} endpoints</div>
                                    <span>‚ñº</span>
                                </div>
                                <div class="category-content">
                                    <div class="endpoints-grid">
                                        ${match.endpoints.map(ep => `
                                            <div class="endpoint-card">
                                                <div class="endpoint-header">
                                                    <span class="method-badge method-${ep.method.toLowerCase()}">${ep.method}</span>
                                                    <span class="endpoint-path">${ep.path}</span>
                                                </div>
                                                <div class="endpoint-description">${ep.desc}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                    ${match.details ? `
                                        <div class="info-box" style="margin-top: 1rem;">
                                            <span class="info-icon">‚ÑπÔ∏è</span>
                                            <div class="info-content">
                                                ${match.details.map(d => `<div>‚Ä¢ ${d}</div>`).join('')}
                                            </div>
                                        </div>
                                    ` : ''}
                                    ${match.notes ? `
                                        <div class="info-box warning" style="margin-top: 1rem;">
                                            <span class="info-icon">üí°</span>
                                            <div class="info-content">${match.notes}</div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    } else if (match.details) {
                        html += `
                            <div class="category-section">
                                <div class="category-header" onclick="toggleCategory(this)">
                                    <div class="category-icon">${match.icon}</div>
                                    <div class="category-title">${match.title}</div>
                                    <span>‚ñº</span>
                                </div>
                                <div class="category-content">
                                    <div class="info-box">
                                        <span class="info-icon">‚ÑπÔ∏è</span>
                                        <div class="info-content">
                                            ${match.details.map(d => `<div>‚Ä¢ ${d}</div>`).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                });
            }

            // Show Tasks API matched endpoints
            Object.entries(tasksApiKnowledge).forEach(([key, match]) => {
                if (query.toLowerCase().includes('task') || query.toLowerCase().includes('checklist') || query.toLowerCase().includes('kanban')) {
                    if (match.endpoints && match.endpoints.length > 0) {
                        html += `
                            <div class="category-section">
                                <div class="category-header" onclick="toggleCategory(this)" style="border-color: rgba(0, 212, 170, 0.3);">
                                    <div class="category-icon" style="background: rgba(0, 212, 170, 0.1); color: #00d4aa;">${match.icon}</div>
                                    <div class="category-title">${match.title}</div>
                                    <span style="background: rgba(0, 212, 170, 0.15); color: #00d4aa; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem;">TASKS API</span>
                                    <div class="category-count">${match.endpoints.length} endpoints</div>
                                    <span>‚ñº</span>
                                </div>
                                <div class="category-content">
                                    <div class="info-box" style="background: rgba(0, 212, 170, 0.1); border-color: rgba(0, 212, 170, 0.2);">
                                        <span class="info-icon" style="color: #00d4aa;">üìã</span>
                                        <div class="info-content">
                                            <strong>Hubstaff Tasks API</strong> (separate product)<br>
                                            Base URL: https://tasks.hubstaff.com/api
                                        </div>
                                    </div>
                                    <div class="endpoints-grid">
                                        ${match.endpoints.map(ep => `
                                            <div class="endpoint-card" style="border-color: rgba(0, 212, 170, 0.3);">
                                                <div class="endpoint-header">
                                                    <span class="method-badge method-${ep.method.toLowerCase()}">${ep.method}</span>
                                                    <span class="endpoint-path">${ep.path}</span>
                                                </div>
                                                <div class="endpoint-description">${ep.desc}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                    ${match.capabilities ? `
                                        <div class="info-box success" style="margin-top: 1rem;">
                                            <span class="info-icon">‚úÖ</span>
                                            <div class="info-content"><strong>Can Do:</strong> ${match.capabilities.join(', ')}</div>
                                        </div>
                                    ` : ''}
                                    ${match.limitations && match.limitations.length > 0 ? `
                                        <div class="info-box warning" style="margin-top: 1rem;">
                                            <span class="info-icon">‚ö†Ô∏è</span>
                                            <div class="info-content"><strong>Limitations:</strong> ${match.limitations.join(', ')}</div>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    }
                }
            });

            // Support Tips - Always show helpful reminders
            html += `
                <div class="answer-card" style="border-color: rgba(139, 92, 246, 0.3); margin-top: 1.5rem;">
                    <div class="answer-header" style="border-bottom-color: rgba(139, 92, 246, 0.2);">
                        <div class="answer-icon" style="background: rgba(139, 92, 246, 0.1); color: #8b5cf6;">üí°</div>
                        <div class="answer-title">Support Tips</div>
                    </div>
                    <div class="answer-content">
                        <div style="display: grid; gap: 0.75rem;">
                            <div style="display: flex; align-items: start; gap: 0.5rem;">
                                <span>üí∞</span>
                                <span><strong>Plan & Pricing:</strong> API access requires <strong>Team</strong> or <strong>Enterprise</strong> plan. <a href="https://hubstaff.com/pricing" target="_blank" style="color: var(--accent-purple);">View pricing page ‚Üí</a></span>
                            </div>
                            <div style="display: flex; align-items: start; gap: 0.5rem;">
                                <span>üìç</span>
                                <span><strong>Check-in/Check-out:</strong> Explicit attendance tracking requires the <strong>Locations add-on</strong> (Job Sites with geofencing). Activity-based attendance is included in all plans.</span>
                            </div>
                            <div style="display: flex; align-items: start; gap: 0.5rem;">
                                <span>‚ö°</span>
                                <span><strong>Rate Limits:</strong> 350 requests/minute per token. Use <code style="background: var(--bg-dark); padding: 2px 6px; border-radius: 4px;">X-RateLimit-Remaining</code> header to monitor.</span>
                            </div>
                            <div style="display: flex; align-items: start; gap: 0.5rem;">
                                <span>üîê</span>
                                <span><strong>Authentication:</strong> API tokens are managed in <strong>Settings ‚Üí Integrations ‚Üí API</strong> by organization admins.</span>
                            </div>
                            <div style="display: flex; align-items: start; gap: 0.5rem;">
                                <span>üìñ</span>
                                <span><strong>Developer Docs:</strong> <a href="https://developer.hubstaff.com/" target="_blank" style="color: var(--accent-purple);">API Documentation</a> ¬∑ <a href="https://developer.hubstaff.com/authentication" target="_blank" style="color: var(--accent-purple);">Auth Guide</a> ¬∑ <a href="https://github.com/NetsoftHoldings/public-api-postman" target="_blank" style="color: var(--accent-purple);">Postman Collection</a></span>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Related topics
            if (results.relatedTopics.length > 0) {
                html += `
                    <div class="related-topics">
                        <div class="related-title">Related topics you might find useful:</div>
                        <div class="related-tags">
                            ${results.relatedTopics.map(topic => `
                                <span class="related-tag" onclick="quickSearch('${topic.toLowerCase()}')">${topic}</span>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            section.innerHTML = html;
        }

        function toggleCategory(element) {
            const content = element.nextElementSibling;
            const arrow = element.querySelector('span:last-child');
            content.classList.toggle('open');
            arrow.textContent = content.classList.contains('open') ? '‚ñ≤' : '‚ñº';
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('resultsSection').innerHTML = `
                <div class="empty-state" id="emptyState">
                    <div class="empty-icon">üí°</div>
                    <h3>Ask a question about Hubstaff API</h3>
                    <p>For example: "Can I sync timesheets with an ERP?" or "What authentication methods are supported?"</p>
                </div>
            `;
        }

        function copyAnswer() {
            const answerContent = document.querySelector('.answer-content');
            const text = answerContent.innerText;
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.querySelector('.copy-btn span:last-child');
                btn.textContent = 'Copied!';
                setTimeout(() => {
                    btn.textContent = 'Copy Response';
                }, 2000);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderKnowledgeBase();
            
            // Enter key handler
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleSearch();
                }
            });
        });
    </script>
</body>
</html>
